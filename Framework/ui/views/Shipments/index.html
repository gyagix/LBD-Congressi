<div x-data="shipmentApp()" x-init="init()">
  <h2>Gestione Spedizioni</h2>

  <div class="filter-list">
    <button class="button-icon button-add" @click="newShipment()">
      <svg width="24" height="24" viewBox="0 0 24 24" aria-label="Nuovo" role="img"
        fill="none" stroke="#000000" stroke-width="6" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 5v14M5 12h14"/>
      </svg>
    </button>

    <button class="button-icon button-add" @click="openEditTableListShowHide()">
      <svg xmlns="http://www.w3.org/2000/svg"
        width="20" height="20" viewBox="0 0 24 24"
        fill="none" stroke="#000000" stroke-width="1"
        stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12c-1.8 3-5 5-9 5s-7.2-2-9-5c1.8-3 5-5 9-5s7.2 2 9 5z"/>
        <line x1="3" y1="3" x2="20" y2="20"/>
      </svg>
    </button>

    <input
      class="input-search"
      type="text"
      placeholder="Cerca..."
      x-model="search"
      @input="filterShipments"
      style="margin-bottom: 1em; width: 100%; padding: 6px;"
    />
  </div>

  <table id="tableList" class="table-list">
    <thead>
      <tr>
        <th>&nbsp;</th>
        <th data-name="Id" @click="sortBy('Id')">ID</th>
        <th data-name="ShipmentName" @click="sortBy('ShipmentName')">Nome Spedizione</th>
        <th data-name="FromVenueName" @click="sortBy('FromVenueName')">Origine</th>
        <th data-name="ToVenueName" @click="sortBy('ToVenueName')">Destinazione</th>
        <th data-name="PickupDate" @click="sortBy('PickupDate')">Pickup</th>
        <th data-name="DeliveryDate" @click="sortBy('DeliveryDate')">Delivery</th>
        <th>&nbsp;</th>
      </tr>
    </thead>
    <tbody>
      <template x-for="shipment in filteredShipments" :key="shipment.Id">
        <tr>
          <td>
            <button @click="editShipment(shipment)">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                viewBox="0 0 20 20" fill="none" stroke="#000000"
                stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 20h9"/>
                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
              </svg>
            </button>
          </td>

          <td data-name="Id" x-text="shipment.Id"></td>
          <td data-name="ShipmentName" x-text="shipment.ShipmentName"></td>
          <td data-name="FromVenueName" x-text="shipment.FromVenueName"></td>
          <td data-name="ToVenueName" x-text="shipment.ToVenueName"></td>
          <td data-name="PickupDate" x-text="formatDateForList(shipment.PickupDate)"></td>
          <td data-name="DeliveryDate" x-text="formatDateForList(shipment.DeliveryDate)"></td>

          <td>
            <button @click="deleteShipment(shipment.Id)">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                viewBox="0 0 20 20" fill="none" stroke="#000000"
                stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18"/>
                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/>
                <path d="M10 11v6M14 11v6"/>
              </svg>
            </button>
          </td>
        </tr>
      </template>
    </tbody>
  </table>

  <div class="overlay overlayhidden" id="overlayContainer">
    <div class="modelContent modelContentHidden" id="editContainer">
      <form @submit.prevent="saveShipment" style="margin-bottom:1em;">
        <input type="hidden" x-model="form.Id" />

        <div>
          <label>Nome Spedizione</label>
          <input type="text" x-model="form.ShipmentName" required />
        </div>

        <div>
          <label>Origine (Venue)</label>
          <select x-model.number="form.FromVenueId" required>
            <option value="">— Seleziona —</option>
            <template x-for="venue in venueOptions" :key="venue.Id">
              <option :value="venue.Id" x-text="venue.VenueName + (venue.Code ? ' ('+venue.Code+')':'' )"></option>
            </template>
          </select>
        </div>

        <div>
          <label>Destinazione (Venue)</label>
          <select x-model.number="form.ToVenueId" required>
            <option value="">— Seleziona —</option>
            <template x-for="venue in venueOptions" :key="venue.Id">
              <option :value="venue.Id" x-text="venue.VenueName + (venue.Code ? ' ('+venue.Code+')':'' )"></option>
            </template>
          </select>
        </div>

        <div>
          <label>Data Pickup</label>
          <input type="date" x-model="form.PickupDate" />
        </div>

        <div>
          <label>Data Delivery</label>
          <input type="date" x-model="form.DeliveryDate" />
        </div>

        <div>
          <label>Note</label>
          <textarea x-model="form.Notes" placeholder="Note" rows="3"></textarea>
        </div>

        <div class="modalContainerContentButtons">
          <button class="modalContentButton" type="submit">
            <span x-text="form.Id ? 'Aggiorna Spedizione' : 'Aggiungi Spedizione'"></span>
            <svg xmlns="http://www.w3.org/2000/svg" 
              width="24" height="24" viewBox="0 0 24 24" 
              fill="none" stroke="currentColor" stroke-width="2" 
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/>
              <polyline points="7 3 7 8 15 8"/>
            </svg>
          </button>

          <button @click="closeModalEdit"
                  type="button"
                  title="Chiudi"
                  class="modalContentButton">
            Chiudi senza salvare
            <svg xmlns="http://www.w3.org/2000/svg" 
              width="24" height="24" viewBox="0 0 24 24" 
              fill="none" stroke="currentColor" stroke-width="2" 
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
              <polyline points="16 17 21 12 16 7"/>
              <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
          </button>
        </div>
      </form>
    </div>

    <div id="divLoading" class="loading-box loading-hide">
      <span class="close-btn" @click="hideLoading">&times;</span>
      <p class="loading-text">Salvataggio in corso...</p>
      <svg class="spinner" viewBox="0 0 50 50">
        <circle cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
      </svg>
    </div>

    <div id="editVisibilityTableCols" class="modalShowHideTableCols modalShowHideTableColsHidden">
      <h3>Mostra/Nascondi colonne</h3>

      <label class="checkbox-item">
        <input type="checkbox" x-model="tableListCkAllChecked" @change="editTableListToggleAll()">
        <span>Seleziona/Togli tutti</span>
      </label>

      <div class="checkbox-list-columns">
        <template x-for="(field, index) in fields" :key="field.name">
          <label class="checkbox-item">
            <input type="checkbox" x-model="field.showInTableList">
            <span x-text="field.label"></span>
          </label>
        </template>
      </div>

      <div class="modal-actions">
        <button class="btn" @click="saveTableListShowHide()">Conferma e chiudi</button>
      </div>
    </div>
  </div>

  <div id="divNotification" class="notification">
    <span id="notifMsg"></span>
    <span class="close-btn" @click="hideNotification">&times;</span>
  </div>
</div>
